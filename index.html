<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mind-ar-face-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; z-index: 999; display: flex; 
            flex-direction: column; justify-content: center; align-items: center;
        }
        button {
            padding: 20px 40px; font-size: 18px; background: #FFB6C1;
            border: none; border-radius: 50px; color: #444; font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #status { margin-top: 20px; font-size: 14px; color: #888; }
    </style>
</head>
<body>
    <div id="overlay">
        <button id="start-btn">自撮りARを開始する</button>
        <div id="status">カメラの読み込みに時間がかかる場合があります</div>
    </div>

    <a-scene 
        mindar-face="autoStart: false; uiLoading: no; uiError: yes; uiScanning: no;" 
        embedded vr-mode-ui="enabled: false" 
        device-orientation-permission-ui="enabled: false">
        
        <a-assets>
            <img id="sakura-img" src="img/sakura.png">
        </a-assets>

        <a-camera active="false" position="0 0 0"></a-camera>

        <a-entity mindar-face-target="anchorIndex: 8">
            <a-plane 
                src="#sakura-img" 
                position="0 0 0.1" 
                width="0.3" height="0.3" 
                material="transparent: true; alphaTest: 0.5; shader: flat">
            </a-plane>
        </a-entity>
    </a-scene>

    <script>
        const startBtn = document.querySelector('#start-btn');
        const overlay = document.querySelector('#overlay');
        const sceneEl = document.querySelector('a-scene');

        startBtn.addEventListener('click', () => {
            startBtn.innerHTML = "起動中...";
            // A-Frame の mindar-face システムを直接起動
            const system = sceneEl.systems['mindar-face-system'];
            system.start(); 
        });

        sceneEl.addEventListener("arReady", () => {
            overlay.style.display = "none";
        });

        sceneEl.addEventListener("arError", (e) => {
            alert("カメラエラーが発生しました。ブラウザの設定でカメラを許可してください。");
            startBtn.innerHTML = "再開する";
        });
    </script>
</body>
</html>